<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>05createOptionObject.html</title>
    <style>
      .week-container {
        display: flex;
      }

      #dayBox {
        width: 30px;
        height: 30px;
        background-color: lightgray;
        border: 1px solid gray;
        text-align: center;
        line-height: 30px;
      }
      .day-box {
        width: 30px;
        height: 30px;
        background-color: lightgray;
        border: 1px solid gray;
        text-align: center;
        line-height: 30px;
      }
    </style>
  </head>
  <body>
    <select id="idSelectYear"></select>
    <select id="idSelectMonth"></select>
    <select id="idSelectDay"></select>

    <div class="week-container">
      <div class="day-box" id="0">Sun</div>
      <div class="day-box" id="1">Mon</div>
      <div class="day-box" id="2">Tue</div>
      <div class="day-box" id="3">Wed</div>
      <div class="day-box" id="4">Thu</div>
      <div class="day-box" id="5">Fri</div>
      <div class="day-box" id="6">Sat</div>
    </div>
    <div id="daysContainer"></div>

    <script>
      document
        .getElementById("idSelectYear")
        .addEventListener("change", addDay);
      document
        .getElementById("idSelectMonth")
        .addEventListener("change", addDay);

      // 找該年的第一天是星期幾，後順序排列li or td
      function addDay() {
        //parse a string and convert it into an integer
        let selectedYear = parseInt(
          document.getElementById("idSelectYear").value
        );

        let selectedMonth = parseInt(
          document.getElementById("idSelectMonth").value
        );

        let daysSelect = document.getElementById("idSelectDay");
        daysSelect.innerHTML = "";

        let firstDaySelectedMonth = new Date(
          selectedYear,
          selectedMonth - 1,
          1
        ).getDay();
        console.log(firstDaySelectedMonth);
        let lastDaySelectedMonth = new Date(
          selectedYear,
          selectedMonth,
          0
        ).getDate();

        let docFrag = document.createDocumentFragment();

        for (let i = 1; i <= lastDaySelectedMonth; i++) {
          //製造選項
          let opt = document.createElement("option");
          opt.setAttribute("value", i);
          let optTxt = document.createTextNode(i); //創造可看到的文字元素
          opt.appendChild(optTxt); //放入option中
          docFrag.appendChild(opt);
        }
        daysSelect.appendChild(docFrag);

        let daysContainer = document.getElementById("daysContainer");

        // daysContainer.innerHTML = "";

        //製造日期格子

        if (daysContainer.children.length === 0) {
          for (let i = 1; i <= lastDaySelectedMonth; i++) {
            let dayDiv = document.createElement("div");
            dayDiv.setAttribute("id", "dayBox");
            dayDiv.innerHTML = i;
            daysContainer.appendChild(dayDiv);
          }
        }

        let dayBoxes = document.querySelectorAll(".day-box");
        let dayIndex;
        dayBoxes.forEach((box, i) => {
          //forEach 方法用於對數組或 NodeList 中的每個元素執行提供的函數。在這種情況下，提供的函數有兩個參數：box 和 i。

          //box: 這個參數表示在迴圈的每一次迭代中處理的 dayBoxes NodeList 中的當前元素。在函數內部，您可以通過 box 來引用當前元素。

          //i: 這個參數表示在迴圈的每一次迭代中，當前元素在 dayBoxes NodeList 中的索引。對於第一個元素，索引為 0；對於第二個元素，索引為 1，以此類推。
          dayIndex = (firstDaySelectedMonth + i + 1) % 7;
          box.setAttribute("data-dayIndex", dayIndex);
          console.log("ff" + box);
        });
        console.log(dayIndex);

        // console.log(dayBoxes);
        // console.log(selectedYear);
        // console.log(selectedMonth);
      }
      addDay();

      let docFrag = document.createDocumentFragment();
      //當您需要執行多個操作來構建或修改 DOM 節點時，將這些操作放在 DocumentFragment 中，最後再將整個 DocumentFragment 插入到文檔中。這樣可以減少重排（reflow）和重繪（repaint）的次數

      for (let i = 2010; i <= 2030; i++) {
        //新增年
        let opt = document.createElement("option");
        opt.setAttribute("value", i);
        let optTxt = document.createTextNode(i);
        opt.appendChild(optTxt);
        //opt.value = i;
        //opt.innerHTML = i;
        docFrag.appendChild(opt);
      }
      document.getElementById("idSelectYear").appendChild(docFrag);

      docFrag = document.createDocumentFragment();
      for (let i = 1; i <= 12; i++) {
        //新增月
        let opt = document.createElement("option");
        opt.setAttribute("value", i);
        let optTxt = document.createTextNode(i);
        opt.appendChild(optTxt);
        //opt.value = i;
        //opt.innerHTML = i;
        docFrag.appendChild(opt);
      }
      document.getElementById("idSelectMonth").appendChild(docFrag);
    </script>
  </body>
</html>
